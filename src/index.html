<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Results for {{ workspace }}</title>
    <meta name="description" content="Results for {{workspace}}">
  </head>
  <body>
    <header class="row">
      <h1>Workspace {{ workspace }}</h1>
      <h2>Repository {{ repo }}</h2>
      <h3>Generated on {{ current_time }}</h3>
    </header>

    <div id="wrapper">
      <ul id="navigation column">
        {% for name, action in actions.items() %}
        <li>
          <div data-show="{{ name }}-filelist" data-highlight=".action" class="action">
            <span class="state {{ action.state }}">{{ "✅" if action.state == "succeeded" else "❌" }}</span>
            <span class="action">{{ name }}</span>
            <span class="count">({{ action.files|length }})</span>
          </div>
          <ul id="{{ name }}-filelist" class="filelist">
            {% for filename, file in action['files'].items() %}
            <li data-show="{{ filename }}" data-hide=".file" data-highlight=".filelink" class="filelink {{file.privacy_level}}">{{ filename }}</li>
            {% endfor %}
          </ul>
        </li>
        {% endfor %}
      </ul>

      <div class="column content">
        {% for name, action in actions.items() %}
        {% for filename, file in action.files.items() %}
        <section id="{{ filename }}" class="{{ file.type }} file">
          <div class="summary">
            <table>
              <tr><th>Name</th><td>{{ filename }}</td></tr>
              <tr><th>Size</th><td>{{ file.path.stat().st_size }}</td></tr>
              <tr><th>Privacy</th><td>{{ file.privacy_level }}</td></tr>
              <tr><th>Action</th><td>{{ name }}</td></tr>
            </table>
          </div>
          <div class="contents">
            {% if file.html %}
            {% if file.truncated %}
            <p>This CSV is very large, and this preview has been truncated.</p>
            {% endif %}
            <div data-load="{{ file.html }}"/>
            {% elif file.type in ("jpeg", "png", "svg") %}
            <img data-load="{{ filename }}"/>
            {% elif file.type in ("log", "txt") %}
            <pre data-load="{{ filename }}"/>
            {% elif file.type in ("html") %}
            <iframe data-load="{{ filename }}" sandbox="allow-same-origin allow-scripts"></iframe>
            {% else %}
            <p>We cannot display this file type, but you can download it: <a href="{{ filename }}">{{ filename }}</a></p>
            {% endif %}
          </div>
        </section>
        {% endfor %}
        {% endfor %}
      </div>

    </div>
    <script type="module" src="/main.js"></script>
  </body>
</html>
